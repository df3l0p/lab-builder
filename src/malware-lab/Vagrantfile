BOX_WKS_BASE = "{{vag_box_wks_name}}"

Vagrant.configure(2) do |config|

  config.vm.define "{{sinkhole_name}}" do |cfg|

    cfg.vm.box = "{{vag_box_sinkhone_name}}"
    cfg.vm.box_version = "{{vag_box_sinkhone_version}}"
    cfg.vm.network "private_network", ip: "{{sinkhole_ip}}"

    cfg.vm.provider "virtualbox" do |vb, override|
      vb.name = '{{sinkhole_name}}'
      vb.gui = true
      vb.memory = "2048"
      vb.customize ["modifyvm", :id, "--vram", "32"]
      vb.customize ["setextradata", "global", "GUI/SuppressMessages", "all" ]
    end
    
    cfg.vm.provision "shell", path: "res/scripts/setup.sh"
    cfg.vm.provision "reload"
  end

  config.vm.define "{{host_01_name}}" do |cfg|
    cfg.vm.box = BOX_WKS_BASE
    cfg.vm.hostname = '{{host_01_name}}'
    cfg.vm.communicator = "winrm"
    cfg.winrm.basic_auth_only = true
    cfg.winrm.timeout = 600
    cfg.winrm.retry_limit = 20
    cfg.vm.network "private_network", ip: "{{host_01_ip}}", gateway: "{{sinkhole_ip}}", dns: "{{sinkhole_ip}}"
    cfg.vm.provider 'virtualbox' do |vb, override|
      override.vm.box = BOX_WKS_BASE + "-virtualbox"
      vb.gui = true
      vb.name = '{{host_01_name}}'
      vb.memory = "2048"
      vb.cpus = 2
      vb.default_nic_type = "82545EM"
      vb.customize ["modifyvm", :id, "--vram", "32"]
      vb.customize ["modifyvm", :id, "--clipboard", "bidirectional"]
      vb.customize ["setextradata", "global", "GUI/SuppressMessages", "all" ]
    end

    cfg.vm.provision "shell", path: "res/scripts/set-keyboard.ps1"
    cfg.vm.provision "shell", path: "res/scripts/copy-tools.ps1"
    cfg.vm.provision "shell", path: "res/scripts/set-networking.ps1", run: "always"
  end
end
